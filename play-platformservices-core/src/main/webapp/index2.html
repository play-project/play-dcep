<html>
<head>
<script src="/webjars/jquery.min.js"></script>
<script src="/webjars/underscore-min.js"></script>
<script src="/webjars/backbone.min.js"></script>
<script src="/webjars/jquery.tmpl.min.js"></script>

<script type="text/javascript">

var Entities = {};

Entities.Collection = Backbone.Collection.extend({
    url: '/patterns'
});
 
Entities.Views = {};
 
Entities.Views.Edit = Backbone.View.extend({
    change: function () {
        this.model.set({
            name: $(this.el).children('input').val()
        });
        this.model.save();
    },
    destroy: function () {
        var el = this.el;
        this.model.destroy({
            success: function () {
                $(el).remove();
            }
        });
    },
    events: {
        'click button': 'destroy',
        'change input': 'change'
    },
    initialize: function () {
        _(this).bindAll('change', 'destroy', 'render');
    },
    render: function () {
        $('#entity-template').tmpl(this.model.toJSON()).appendTo(this.el);
        this.delegateEvents();
    }
});
 
Entities.Views.List = Backbone.View.extend({
    append: function (model) {
        var p = $('<p>').appendTo('#entities'),
            view = new Entities.Views.Edit({
                model: model,
                el: p[0]
            });
        view.render(); 
    },
    initialize: function () {
        _(this).bindAll('append', 'render');
        this.collection.bind('refresh', this.render);
        this.collection.bind('add', this.append);
    },
    render: function () {
        $('#entities').empty();
        this.collection.each(function (model) {
            this.append(model);
        }, this);
    }
});
 
$(function () {
    var collection = new Entities.Collection(),
        view = new Entities.Views.List({
            collection: collection
        });
 
    collection.fetch();
     
    $('#add').click(function () {
        var model = new Backbone.Model({
            name: $('#new-name').val()
        });
        collection.add(model);
        model.save();
    });
});

</script>

</head>

    <body>
        <p><input id="new-name" type="text"><button id="add">Add</button></p>
        <div id="entities"></div>
    </body>
    <script id="entity-template" type="x-jquery-tmpl">
        <input type="text" value="${name}">
        <button>Delete</button>
    </script>
    
</html>